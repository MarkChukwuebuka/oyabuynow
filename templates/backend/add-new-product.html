{% extends "./partials/base.html" %}
{% load static %}


{% block content %}

<style>
  #image_preview img {
  transition: transform 0.2s ease;
}
#image_preview img:hover {
  transform: scale(1.05);
}

</style>
                <div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="row">
        <div class="col-sm-8 m-auto">
          <div class="card">
            <div class="card-body">
              <div class="card-header-2">
                <h5>Product Information</h5>
              </div>

              <form
                class="theme-form theme-form-2 mega-form"
                method="POST"
                enctype="multipart/form-data"
              >
                {% csrf_token %}

                <!-- Product Name -->
                <div class="mb-4 row align-items-center">
                  <label class="form-label-title col-sm-3 mb-0"
                    >Product Name</label
                  >
                  <div class="col-sm-9">
                    <input
                      class="form-control"
                      type="text"
                      name="name"
                      placeholder="Product Name"
                      value="{{ request.POST.name }}"
                      required
                    />

                  </div>
                </div>

                <!-- Price -->
                <div class="mb-4 row align-items-center">
                  <label class="form-label-title col-sm-3 mb-0">Price</label>
                  <div class="col-sm-9">
                    <input
                      class="form-control"
                      type="number"
                      name="price"
                      placeholder="0.00"
                      value="{{ request.POST.price }}"
                      required
                    />
                  </div>
                </div>

                <!-- Discount -->
                <div class="mb-4 row align-items-center">
                  <label class="form-label-title col-sm-3 mb-0"
                    >Percentage Discount</label
                  >
                  <div class="col-sm-9">
                    <input
                      class="form-control"
                      type="number"
                      name="percentage_discount"
                      placeholder="0.00"
                      value="{{ request.POST.percentage_discount }}"
                    />

                  </div>
                </div>

                <!-- Category -->
                <div class="mb-4 row align-items-center">
                  <label class="col-sm-3 col-form-label form-label-title"
                    >Category</label
                  >
                  <div class="col-sm-9">
                    <select
                      id="category-select"
                      class="js-example-basic-single w-100"
                      name="category"
                    >
                      <option disabled selected>Category Menu</option>
                      {% for category in categories %}
                      <option value="{{ category.id }}">
                        {{ category.name }}
                      </option>
                      {% endfor %}
                    </select>

                  </div>
                </div>

                <!-- SubCategory -->
                <div class="mb-4 row align-items-center">
                  <label class="col-sm-3 col-form-label form-label-title"
                    >SubCategory</label
                  >
                  <div class="col-sm-9">
                    <select
                      id="subcategory-select"
                      class="js-example-basic-multiple w-100"
                      name="subcategories"
                      multiple
                    >
                      <option disabled>Sub Category Menu</option>
                    </select>

                  </div>
                </div>

                <!-- Stock -->
                <div class="mb-4 row align-items-center">
                  <label class="form-label-title col-sm-3 mb-0">Stock</label>
                  <div class="col-sm-9">
                    <input
                      class="form-control"
                      type="number"
                      name="stock"
                      placeholder="0"
                      value="{{ request.POST.stock }}"
                      required
                    />

                  </div>
                </div>

                <!-- Short Description -->
                <div class="mb-4 row align-items-center">
                  <label class="form-label-title col-sm-3 mb-0"
                    >Short Description</label
                  >
                  <div class="col-sm-9">
                    <input
                      class="form-control"
                      type="text"
                      name="short_description"
                      placeholder="Short Description of the product"
                      value="{{ request.POST.short_description }}"
                      required
                    />

                  </div>
                </div>

                <!-- Description -->
                <div class="mb-4 row align-items-center">
                  <label class="form-label-title col-sm-3 mb-0"
                    >Description</label
                  >
                  <div class="col-sm-9">
                    <textarea
                      id="product-description"
                      class="form-control"
                      name="description"
                      placeholder="Description of the product"
                    >
                      {{ request.POST.description }}
                    </textarea
                    >
                    {% if form_errors.description %}
                    <div class="text-danger mt-1 small">
                      {{ form_errors.description.0 }}
                    </div>
                    {% endif %}
                  </div>
                </div>

                <!-- Tags -->
                {% if tags %}
                <div class="mb-4 row align-items-center">
                  <label class="col-sm-3 col-form-label form-label-title"
                    >Tags</label
                  >
                  <div class="col-sm-9">
                    <select
                      id="tags"
                      class="js-example-basic-multiple w-100"
                      name="tags"
                      multiple
                    >
                      <option disabled>Tag Menu</option>
                      {% for tag in tags %}
                      <option value="{{tag.id}}">{{tag.name}}</option>
                      {% endfor %}
                    </select>

                  </div>
                </div>
                {% endif %}

                <!-- Brands -->
                {% if brands %}
                <div class="mb-4 row align-items-center">
                  <label class="col-sm-3 col-form-label form-label-title"
                    >Brands</label
                  >
                  <div class="col-sm-9">
                    <select
                      id="brands"
                      class="js-example-basic-multiple w-100"
                      name="brands"
                      multiple
                    >
                      <option disabled>Brand Menu</option>
                      {% for brand in brands %}
                      <option value="{{brand.id}}">{{brand.name}}</option>
                      {% endfor %}
                    </select>

                  </div>
                </div>
                {% endif %}


                <!-- Product Variations -->
                <div class="card mt-4">
                  <div class="card-body">
                    <div class="card-header-2">
                      <h5>Product Variations</h5>
                    </div>
                    {% if colors %}
                    <div class="mb-4 row align-items-center">
                      <label class="col-sm-3 col-form-label form-label-title">Colors</label>
                      <div class="col-sm-9">
                        <select class="js-example-basic-multiple w-100" name="colors" multiple>
                          {% for color in colors %}
                          <option value="{{ color.id }}">
                            {{ color.name }} ({{ color.hex_code }})
                          </option>
                          {% endfor %}
                        </select>

<!--                        <div class="mt-3 d-flex align-items-center gap-2">-->
<!--                          <input-->
<!--                            type="text"-->
<!--                            name="new_color_name"-->
<!--                            placeholder="New color name"-->
<!--                            class="form-control w-50"-->
<!--                          />-->
<!--                          <input-->
<!--                            type="color"-->
<!--                            name="new_color_hex"-->
<!--                            value="#000000"-->
<!--                            class="form-control form-control-color w-25"-->
<!--                          />-->
<!--                        </div>-->

                      </div>
                    </div>
                    {% endif %}
                      <div class="mb-4 row align-items-center">
                          <label class="col-sm-3 col-form-label form-label-title"
                            >Sizes</label
                          >
                          <div class="col-sm-9">
                            <input
                              class="form-control"
                              type="text"
                              name="sizes"
                              placeholder="Sizes"
                            />

                          </div>
                      </div>
                  </div>
                </div>

                <!-- Sales -->
                <div class="card mt-4">
                  <div class="card-body">
                    <div class="card-header-2">
                      <h5>Sales</h5>
                    </div>

                    <div class="row align-items-center mb-3">
                      <label class="col-sm-3 col-form-label form-label-title"
                        >Add to Sales</label
                      >
                      <div class="col-sm-9">
                        <label class="switch">
                          <input type="hidden" name="add_product_to_sales" value="False" />
                          <input type="checkbox" name="add_product_to_sales" value="True" />
                          <span class="switch-state"></span>
                        </label>
                      </div>
                    </div>

                    <div class="row align-items-center mb-3">
                      <label class="col-sm-3 col-form-label form-label-title"
                        >Start Date/Time</label
                      >
                      <div class="col-sm-9">
                        <input
                          type="datetime-local"
                          name="sale_start"
                          class="form-control"
                        />
                      </div>
                    </div>

                    <div class="row align-items-center">
                      <label class="col-sm-3 col-form-label form-label-title"
                        >End Date/Time</label
                      >
                      <div class="col-sm-9">
                        <input
                          type="datetime-local"
                          name="sale_end"
                          class="form-control"
                        />
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Media -->
                <div class="card mt-4">
                  <div class="card-body">
                    <div class="card-header-2">
                      <h5>Product Media</h5>
                    </div>

                    <div class="mb-4 row align-items-center">
                      <label class="col-sm-3 col-form-label form-label-title"
                        >Images/Videos</label
                      >
                      <div class="col-sm-9">
                        <input
                          type="file"
                          id="product_images"
                          name="media"
                          class="form-control"
                          accept="image/*"
                          multiple
                        />
                        <div id="image_preview" class="mt-3 d-flex flex-wrap gap-2"></div>

                      </div>
                    </div>
                  </div>
                </div>

                <!-- Dimensions -->
                <div class="card mt-4">
                  <div class="card-body">
                    <div class="card-header-2">
                      <h5>Dimensions</h5>
                    </div>

                    <div class="mb-4 row align-items-center">
                      <label class="form-label-title col-sm-3 mb-0"
                        >Weight (kg)</label
                      >
                      <div class="col-sm-9">
                        <input
                          class="form-control"
                          type="number"
                          name="weight"
                          value="{{ request.POST.weight }}"
                          placeholder="Weight"
                        />

                      </div>
                    </div>

                    <div class="row align-items-center">
                      <label class="col-sm-3 col-form-label form-label-title"
                        >Dimensions (cm)</label
                      >
                      <div class="col-sm-9">
                        <input
                          class="form-control"
                          type="text"
                          name="dimensions"
                          value="{{ request.POST.dimensions }}"
                          placeholder="Length X Width X Breadth"
                        />

                      </div>
                    </div>
                  </div>
                </div>

                <!-- Submit Button -->
                <div class="text-end mt-4 mb-5">
                  <button type="submit" class="btn btn-primary">
                    Submit Product
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>





<script>
document.addEventListener("DOMContentLoaded", function() {
    const categorySelect = document.getElementById("category-select");
    const subcategorySelect = document.getElementById("subcategory-select");

    if (!categorySelect) {
        console.error("Category select not found");
        return;
    }

    categorySelect.addEventListener("change", function() {
        const categoryId = this.value;

        if (!categoryId) return;

        fetch(`/api/get-subcategories/${categoryId}/`)
            .then(response => {
                if (!response.ok) throw new Error("Failed to fetch subcategories");
                return response.json();
            })
            .then(data => {
                subcategorySelect.innerHTML = "";

                if (data.length > 0) {
                    data.forEach(item => {
                        const option = document.createElement("option");
                        option.value = item.id;
                        option.textContent = item.name;
                        subcategorySelect.appendChild(option);
                    });
                } else {
                    const option = document.createElement("option");
                    option.disabled = true;
                    option.textContent = "No subcategories found";
                    subcategorySelect.appendChild(option);
                }
            })
            .catch(error => {
                console.error("Error loading subcategories:", error);
            });
    });
});


$(document).ready(function() {
    $('.js-example-basic-multiple').select2({
        placeholder: "Select or add colors",
        allowClear: true
    });
});



document.addEventListener('DOMContentLoaded', function () {
  const input = document.getElementById('product_images');
  const previewContainer = document.getElementById('image_preview');

  input.addEventListener('change', function () {
    previewContainer.innerHTML = ''; // clear previous previews

    Array.from(input.files).forEach((file) => {
      if (!file.type.startsWith('image/')) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const preview = document.createElement('div');
        preview.classList.add('position-relative');

        preview.innerHTML = `
          <img src="${e.target.result}" alt="${file.name}" class="rounded border" style="width: 100px; height: 100px; object-fit: cover;">
          <button type="button" class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1">&times;</button>
        `;

        // Allow removing the preview (and the file)
        preview.querySelector('button').addEventListener('click', () => {
          const dt = new DataTransfer();
          Array.from(input.files)
            .filter(f => f !== file)
            .forEach(f => dt.items.add(f));
          input.files = dt.files;
          preview.remove();
        });

        previewContainer.appendChild(preview);
      };
      reader.readAsDataURL(file);
    });
  });
});


</script>


{% endblock content %}